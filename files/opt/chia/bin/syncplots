#!/usr/bin/env bash

sync_src=${1:?"ERROR: A local sync source location must be provided."}

while [ 0 ]; do
  for dst in `cat ${CHIA_SYNCDST}`; do
    set +e
    echo "[`date`] Backing up ${sync_src} to ${dst}"
    echo ezplot uploadplots ${sync_src} ${dst} || (echo "Sync existed with a non-zero exit code $?" ; sleep 10)
    set -e
  done
  echo "[`date`] Sleeping for 5m"
  sleep 300
done
